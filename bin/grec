#!/bin/sh

if [ $# -lt 1 ] ; then
  echo "$0: at least one argument is required"
  exit 1
fi

query="grep --color=always -n -r $1 ."

shift

while [ $# -gt 0 ] ; do
  if [ "$(echo "$1" | grep -oE -e '^-')" = '-' ] ; then
    q=$(echo "$1" | sed -e 's/^-//g')
    query+=" | grep --color=always -v $q"
  else
    query+=" | grep --color=always $1"
  fi
  shift
done

echo "exec: $query"

# ugly workaround
sh -c "$query"
